<style>

  :host {
    font-family: system-ui, -apple-system, sans-serif;
    box-sizing: border-box;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  main {
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    gap: 1.5rem;
    background: #f5f5f7;
    min-height: 100vh;
  }

  .content {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    gap: 2rem;
    max-width: 1600px;
  }

  /* Consistent card styling */
  .card {
    background: #ffffff;
    border-radius: 1rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.06);
  }

  .card-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    font-size: 1rem;
    font-weight: 500;
    color: #1c1b1f;
  }

  .card-content {
    padding: 1.25rem;
  }

  /* Layout sections */
  .left-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .right-section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  router-outlet {
    display: none;
  }
</style>

<main class="main">
  <!-- View Mode Toggle -->
  <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
    <button
      (click)="viewMode = 'rover'"
      [style.background]="viewMode === 'rover' ? '#3498db' : '#95a5a6'"
      style="padding: 0.75rem 1.5rem; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.2s;">
      Rover Control
    </button>
    <button
      (click)="viewMode = 'training'"
      [style.background]="viewMode === 'training' ? '#3498db' : '#95a5a5a6'"
      style="padding: 0.75rem 1.5rem; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.2s;">
      Training Monitor
    </button>
  </div>

  <!-- Rover View -->
  <div class="content" *ngIf="viewMode === 'rover'">
    <!-- Left Section: Zone & Parameters -->
    <div class="left-section">
      <div class="card" style="min-width: 220px;">
        <div class="card-header">Zone Legend</div>
        <div class="card-content">
          <app-zone-legend [currentZone]="currentZone"></app-zone-legend>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Rover Status</div>
        <div class="card-content" style="display: flex; flex-direction: column; gap: 1rem;">
          <app-parameter-display
            [header]="'Position'"
            [parameters]="positionParams"
            [color]="'#6eb9ff'">
          </app-parameter-display>
          <app-parameter-display
            [header]="'Digging'"
            [parameters]="digModeParams"
            [color]="'#ff9800'">
          </app-parameter-display>
        </div>
      </div>
    </div>

    <!-- Center: Environment -->
    <app-environment
      [roverSpeedMultiplier]="speedValue"
      [roverTargetHeading]="rotationValue">
    </app-environment>

    <!-- Right Section: Detection & Controls -->
    <div class="right-section" style="flex-direction: row;">
      <div class="card" style="width: 320px;">
        <div class="card-header">Detection</div>
        <div class="card-content" style="display: flex; flex-direction: column;">
          <app-detected-obstacles [obstacles]="detectedObstacles"></app-detected-obstacles>
          <app-detected-diggable [diggables]="detectedDiggables"></app-detected-diggable>
        </div>
      </div>

      <div class="card">
        <div class="card-header">AI Model Control</div>
        <div class="card-content" style="display: flex; flex-direction: column; gap: 1rem;">
          <div style="display: flex; gap: 0.5rem; align-items: center;">
            <label style="font-size: 0.875rem; color: #666;">Mode:</label>
            <select
              [(ngModel)]="controlMode"
              (change)="onControlModeChange()"
              style="padding: 0.5rem; border-radius: 0.25rem; border: 1px solid #ddd;">
              <option value="manual">Manual</option>
              <option value="ai">AI Control</option>
            </select>
          </div>

          <div *ngIf="controlMode === 'ai'" style="display: flex; flex-direction: column; gap: 0.75rem;">
            <div style="display: flex; gap: 0.5rem; flex-direction: column;">
              <label style="font-size: 0.875rem; color: #666;">Select Model File (.zip):</label>
              <input
                type="file"
                accept=".zip"
                (change)="onModelFileSelected($event)"
                #fileInput
                style="padding: 0.5rem; border-radius: 0.25rem; border: 1px solid #ddd; font-size: 0.875rem;" />
              <div *ngIf="modelPath" style="font-size: 0.75rem; color: #666;">
                Selected: {{ modelPath }}
              </div>
            </div>

            <button
              (click)="loadAndStartAI()"
              [disabled]="!modelPath || aiRunning"
              style="padding: 0.75rem; background: #27ae60; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;"
              [style.opacity]="!modelPath || aiRunning ? '0.5' : '1'"
              [style.cursor]="!modelPath || aiRunning ? 'not-allowed' : 'pointer'">
              {{ aiRunning ? 'AI Running...' : 'Load Model & Start AI' }}
            </button>

            <button
              *ngIf="aiRunning"
              (click)="stopAI()"
              style="padding: 0.75rem; background: #e74c3c; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
              Stop AI
            </button>

            <div *ngIf="aiStatus" style="padding: 0.75rem; background: #f0f0f0; border-radius: 0.5rem; font-size: 0.875rem;">
              <div style="color: #27ae60;" *ngIf="aiStatus === 'running'">✓ AI is controlling the rover</div>
              <div style="color: #e74c3c;" *ngIf="aiStatus === 'error'">✗ Error loading model</div>
              <div style="color: #f39c12;" *ngIf="aiStatus === 'loading'">⏳ Loading model...</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">Manual Controls</div>
        <div class="card-content">
          <div style="display: flex; gap: 1.5rem; justify-content: center;">
            <app-universal-slider
              [(value)]="speedValue"
              [min]="-1"
              [max]="1"
              [step]="0.01"
              [environmentHeightPx]="environment?.environment_height_px"
              orientation="vertical"
              label="Speed"
              [showValue]="true"
              color="#008526"
              [disabled]="controlMode === 'ai'">
            </app-universal-slider>
            <app-universal-slider
              [(value)]="rotationValue"
              [min]="0"
              [max]="360"
              [step]=".1"
              [environmentHeightPx]="environment?.environment_height_px"
              orientation="vertical"
              label="Heading"
              [showValue]="true"
              color="#7DDA58"
              [disabled]="controlMode === 'ai'">
            </app-universal-slider>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Training Monitor View -->
  <app-training-monitor *ngIf="viewMode === 'training'" style="width: 100%; max-width: 1600px;"></app-training-monitor>
</main>